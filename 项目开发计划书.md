# 视觉驱动型 AI 自动化交易系统 - 开发计划书

## 1. 项目愿景 (Vision)
构建一套**“像人一样看盘，像机器一样执行”**的自动化交易系统。
结合 **缠论 (Chanlun)** 的形态学优势与 **AI (DeepSeek/Qwen)** 的视觉认知能力，实现高精度的“图表+数据”双模驱动交易。

## 2. 系统核心架构 (Architecture)

### 2.1 整体链路
> **TradingView (发令枪)** --> **Python 服务器 (中控)** --> **AI 双脑 (决策)** --> **交易所 (执行)**

### 2.2 关键组件
### 2.2 关键组件详解

#### 1. 信号源 (Signal Source) - **已完成代码改造**
*   **载体**：TradingView (`原始码.pine`)
*   **核心升级**：
    *   **Alert Function**: 使用 `alert()` 函数替代旧的 `alertcondition`。
    *   **JSON Payload**: 自动封装 `{"signal": "1买", "price": 5200, "level": "1m", "chart_url": "..."}`。
    *   **触发机制**：K线收盘确认触警，避免信号闪烁。

#### 2. 视觉中枢 (Vision Hub) - **Python + Playwright**
*   **核心技术**：Playwright (基于 Chromium 内核)。
*   **配置细节**：
    *   **分辨率**：强制 1920x1080 (全屏模式)。
    *   **缩放**：0.75倍缩放 (获取更多K线历史视野)。
    *   **鉴权**：Cookie 注入 (Session ID)，绕过指标数量限制。

#### 3. 消息通知 (Feishu/Lark Integration) - **新增**
*   **对接方式**：飞书群机器人 (Webhook)。
*   **工作流**：
    1.  **信号推送**：Python 收到 TV 信号 -> 立即推送到飞书群（纯文本提醒）。
    2.  **分析推送**：AI 分析完成后 -> 将**截图 + 详细分析报告**再次推送到群。
    3.  **群内互动**：(未来扩展) 在群里 @机器人 查询实时行情。

#### 4. 双脑决策模型 (Dual-Brain AI)
*   **👁️ 眼睛 (Qwen-VL-Max)**：识别中枢、背驰、均线形态。
*   **🧠 大脑 (DeepSeek-V3)**：结合技术指标与视觉描述进行逻辑推理。

## 3. 实施路线图 (Roadmap)

### ✅ 第一阶段：环境验证 (已完成)
*   [x] Python 环境搭建。
*   [x] 浏览器自动化 (Playwright) 调试通过。
*   [x] Cookie 注入鉴权通过。

### ✅ 第二阶段：信号源改造 (已完成)
*   [x] `原始码.pine` 代码已修改。
*   [x] 植入 `get_alert_json` 函数。
*   [x] **待执行**：用户在 TradingView 创建 "Any function call" 警报。

### 🚀 第三阶段：中控系统开发 (即将开始)
*   **任务**：开发 `trade_bot.py`。
*   **子任务**：
    1.  **Webhook Server**: 使用 Flask/FastAPI 接收 TV 信号。
    2.  **Feishu Bot**: 对接飞书 API 发送实时通知。
    3.  **AI Engine**: 串联 Qwen 和 DeepSeek API。


### 💎 第四阶段：实盘与进化
*   **任务**：对接交易所 API & 数据库。
*   **功能**：实盘下单、自动记账、策略自我迭代。

## 4. 成本与配置预算

| 项目 | 推荐配置/方案 | 预估成本 |
| :--- | :--- | :--- |
| **服务器** | Ubuntu 22.04 (2核 4G内存) | ~$15 /月 |
| **TradingView** | Premium/Pro (现有) | 已付费 |
| **视觉 AI** | Qwen-VL-Max | ~$0.1 /天 (极低) |
| **逻辑 AI** | DeepSeek-V3 | ~$0.1 /天 (极低) |

## 5. ClawdBot 部署与运维策略 (Deployment)

### 5.1 ClawdBot 的角色
不仅仅是开发助手，而是**“系统指挥官”**。
*   **开发态**：负责生成代码、调试脚本 (即当前状态)。
*   **运行态**：作为运维面板，监控 `trade_bot.py` 的健康状态。

### 5.2 部署架构
我们采用 **"ClawdBot 托管模式"**：
1.  **基础设施**：代码运行在 Linux/Windows 服务器上。
2.  **守护进程**：使用 `Systemd` (Linux) 或 `NSSM` (Windows) 将 `trade_bot.py` 注册为系统服务，实现**开机自启、崩溃重启**。
3.  **交互接口**：
    *   通过 **Files**（文件读写）修改配置。
    *   通过 **Terminal**（终端）查看实时日志。
    *   通过 **Feishu**（飞书）接收运行报告。

### 5.3 部署指令 (ClawdBot 执行)
未来阶段，你可以直接向 ClawdBot 发送以下“自然语言指令”来管理系统：
*   *"部署服务"* -> 自动生成 Dockerfile 或 Systemd 配置。
*   *"检查日志"* -> 自动读取 logs 目录并分析报错。
*   *"升级策略"* -> 修改 Python 里的 DeepSeek 提示词并重启服务。

## 6. 结论
目前系统设计已经闭环，技术难点（登录鉴权）已攻克。
**下一步行动**：立即执行“第三阶段”，开发核心中控 `trade_bot.py`。
